<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>CATEDisplays: Getting Started</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">CATEDisplays: Getting Started</h1>



<div id="getting-started-generating-data" class="section level2">
<h2>Getting Started: Generating Data</h2>
<p><strong>Elena Badillo-Goicoechea, Ryoko Susukida, and Elizabeth A.
Stuart</strong></p>
<p>2023-11-19</p>
</div>
<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>Personalized treatment decisions, which hold great potential for
improving health outcomes for patients of varying characteristics,
involve the assessment and estimation of individualized or conditional
treatment effects.</p>
<p>However, using data to make these decisions in a reliable, precise,
and generalizable way is challenging when sample sizes are low and/or
are not representative of the target population. Leveraging the
information provided by multiple studies with unconfounded treatment
assignment allows for combining datasets to improve the power to
estimate heterogeneous treatment effects.</p>
<p>CATEDisplays is designed to quickly estimate the conditional average
treatment effect from one or more trials, and provide descriptive and
formal diagnostics to assess the presence of treatment effect
heterogeneity.</p>
<p>The functions in this package are wrapped in the main function <a href>displayCATE()</a> but can run separately. These let the user
seamlessly:</p>
<ol style="list-style-type: decimal">
<li>Estimate the conditional average treatment effect (CATE) coming from
one or more sites and/or trials</li>
<li>Combine data from multiple trials (optionally).</li>
<li>Test for the presence of treatment effect heterogeneity, using
multiple diagnostics, including agnostic test for heterogeneity (see ),
distribution of the CATE by subgroups of interest with confidence
intervals, and a doubly robust best linear projection of the CATE,
provided user-specified covariates and/or predictors.</li>
<li>Visualize results</li>
</ol>
<p>Overall, the procedure This package is mainly designed for
researchers evaluating evidence coming from multiple trials and
interested in inspecting potentially differential treatments effects
across different subpopulations.</p>
<p>To estimate causal forests and the best linear projection,
CATEDisplays uses the <a href="https://cran.r-project.org/web/packages/grf/index.html">grf</a> R
package.</p>
<p>This vignette will guide the reader, step-by-step, on CATEDisplays
basic functionalities, with simulated datasets. Technical details on
each of the package’s main functions and on the sample dataset is
included in the documentation, which the reader is encouraged to
consult, if necessary.</p>
</div>
<div id="package-and-data-set-up" class="section level2">
<h2>2. Package and data set-up</h2>
<p>First, if needed, install the CATEDisplays package with the help of
devtools:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(devtools)){</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(CATEDisplays)){</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;StuartRA/CATEDisplays&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>}</span></code></pre></div>
<p>And load the package by calling its library:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(CATEDisplays)</span></code></pre></div>
<p>Now let’s generate a simple dataset for 5 trials that satisfies the
following basic structure (required for the package to run
seamlessly):</p>
<ol style="list-style-type: decimal">
<li>One dataframe per study/trial, with varying sample sizes (250, 50,
450, 350, 150)</li>
<li>If more than one study or trial is included, all the specified
covariates of interest (e.g. demographics) must be available for each
study/trial and coded in the same manner.</li>
<li>Numerical outcome variable.</li>
</ol>
<p>Although technically not required, if the user wants to merge data
coming from multiple trials, it is highly recommended that the treatment
and outcome have a similar meaning across studies.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">250</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">50</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">450</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">350</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">150</span>, <span class="at">ncol =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>Generate a categorical covariate (“Sex”):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>df1<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="dv">250</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>df2<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="dv">50</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>df3<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="dv">450</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>df4<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="dv">350</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>df5<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="dv">150</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>Generate a continuous covariate (“Age”):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>df1<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="dv">40</span>, <span class="dv">15</span>), <span class="cf">function</span> (x) {<span class="fu">max</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)), <span class="fu">round</span>(x, <span class="dv">2</span>))}))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>df2<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">30</span>, <span class="dv">15</span>), <span class="cf">function</span> (x) {<span class="fu">max</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)), <span class="fu">round</span>(x, <span class="dv">2</span>))}))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>df3<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">rnorm</span>(<span class="dv">450</span>, <span class="dv">25</span>, <span class="dv">15</span>), <span class="cf">function</span> (x) {<span class="fu">max</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)), <span class="fu">round</span>(x, <span class="dv">2</span>))}))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>df4<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">rnorm</span>(<span class="dv">350</span>, <span class="dv">20</span>, <span class="dv">15</span>), <span class="cf">function</span> (x) {<span class="fu">max</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)), <span class="fu">round</span>(x, <span class="dv">2</span>))}))</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>df5<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="dv">40</span>, <span class="dv">15</span>), <span class="cf">function</span> (x) {<span class="fu">max</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>)), <span class="fu">round</span>(x, <span class="dv">2</span>))}))</span></code></pre></div>
<p>Generate a categorical covariate (“Educational level”):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>df1<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Less than HS&#39;</span>, <span class="st">&#39;HS&#39;</span>, <span class="st">&#39;College&#39;</span>, <span class="st">&#39;Graduate&#39;</span>), <span class="dv">250</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>df2<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Less than HS&#39;</span>, <span class="st">&#39;HS&#39;</span>, <span class="st">&#39;College&#39;</span>, <span class="st">&#39;Graduate&#39;</span>), <span class="dv">50</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>df3<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Less than HS&#39;</span>, <span class="st">&#39;HS&#39;</span>, <span class="st">&#39;College&#39;</span>, <span class="st">&#39;Graduate&#39;</span>), <span class="dv">450</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>df4<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Less than HS&#39;</span>, <span class="st">&#39;HS&#39;</span>, <span class="st">&#39;College&#39;</span>, <span class="st">&#39;Graduate&#39;</span>), <span class="dv">350</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>df5<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Less than HS&#39;</span>, <span class="st">&#39;HS&#39;</span>, <span class="st">&#39;College&#39;</span>, <span class="st">&#39;Graduate&#39;</span>), <span class="dv">150</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>Generate a categorical covariate (“Race”):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>df1<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;White&#39;</span>, <span class="st">&#39;Black&#39;</span>, <span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;Hispanic&#39;</span>, <span class="st">&#39;Other&#39;</span>), <span class="dv">250</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>df2<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;White&#39;</span>, <span class="st">&#39;Black&#39;</span>, <span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;Hispanic&#39;</span>, <span class="st">&#39;Other&#39;</span>), <span class="dv">50</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>df3<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;White&#39;</span>, <span class="st">&#39;Black&#39;</span>, <span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;Hispanic&#39;</span>, <span class="st">&#39;Other&#39;</span>), <span class="dv">450</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>df4<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;White&#39;</span>, <span class="st">&#39;Black&#39;</span>, <span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;Hispanic&#39;</span>, <span class="st">&#39;Other&#39;</span>), <span class="dv">350</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>df5<span class="sc">$</span>race <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;White&#39;</span>, <span class="st">&#39;Black&#39;</span>, <span class="st">&#39;Asian&#39;</span>, <span class="st">&#39;Hispanic&#39;</span>, <span class="st">&#39;Other&#39;</span>), <span class="dv">150</span>, <span class="at">replace=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<p>Generate a continuous covariate (“Alcohol Addiction Severity
Index”):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>df1<span class="sc">$</span>ASIalc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="dv">0</span>, <span class="fl">0.55</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>df2<span class="sc">$</span>ASIalc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>df3<span class="sc">$</span>ASIalc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">450</span>, <span class="dv">0</span>, <span class="fl">0.15</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>df4<span class="sc">$</span>ASIalc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">350</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>df5<span class="sc">$</span>ASIalc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="dv">0</span>, <span class="fl">0.35</span>)</span></code></pre></div>
<p>Generate a continuous outcome variable:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>df1<span class="sc">$</span>outc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>df2<span class="sc">$</span>outc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>df3<span class="sc">$</span>outc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">450</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>df4<span class="sc">$</span>outc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">350</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>df5<span class="sc">$</span>outc <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">150</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>)</span></code></pre></div>
<p>Generate a binary treatment assignment variable:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>df1<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">250</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>df2<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">50</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>df3<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">450</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span><span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>df4<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">350</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>df5<span class="sc">$</span>tx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">150</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="fl">0.55</span>))</span></code></pre></div>
<p>Finally, put the single trial dataframes into a list:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>dfList <span class="ot">&lt;-</span> <span class="fu">list</span>(df1, df2, df3, df4, df5)</span></code></pre></div>
</div>
<div id="run-main-wrapper-function" class="section level2">
<h2>3. Run main wrapper function:</h2>
<div id="option-1-not-combining-trials" class="section level3">
<h3>Option 1: Not combining trials</h3>
<p>Here <a href>cateDisplay()</a> will estimate a casual forest and
assess treatment effect heterogeneity separately for each single
trial.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>catesDisplay <span class="ot">&lt;-</span> CATEDisplays<span class="sc">::</span><span class="fu">displayCATE</span>(dfList,</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>                           <span class="at">outCol=</span><span class="st">&quot;outc&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                           <span class="at">txCol=</span><span class="st">&quot;tx&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                           <span class="at">covList=</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;race&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;ASIalc&quot;</span>),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                           <span class="at">blpredList=</span><span class="cn">NULL</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>                           <span class="at">combine=</span>F,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>                           <span class="at">verbose=</span>T,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>                           <span class="at">ci=</span><span class="fl">0.95</span>, <span class="at">nTrees=</span><span class="dv">10000</span>, <span class="at">seedN=</span><span class="dv">7203</span>)</span></code></pre></div>
<p>[1] “– 95% CI for the ATE: -0.134315 +/- 0.184223” [1] “Estimate:
-2.667 || Pr(&gt;t): 0.966” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.” [1] “– 95% CI for the ATE: -0.100775 +/- 0.47401” [1]
“Estimate: -15.893 || Pr(&gt;t): 1” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.” [1] “– 95% CI for the ATE: -0.053472 +/- 0.14277” [1]
“Estimate: 0.742 || Pr(&gt;t): 0.11” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.” [1] “– 95% CI for the ATE: -0.036537 +/- 0.157634” [1]
“Estimate: -3.237 || Pr(&gt;t): 0.996” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.” [1] “– 95% CI for the ATE: 0.095326 +/- 0.247663” [1]
“Estimate: -0.058 || Pr(&gt;t): 0.521” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.”</p>
<p>Inspect output elements for a given study (say, study #2):</p>
<p>ATE:</p>
<pre><code>#&gt;   estimate    std.err 
#&gt; -0.1007754  0.2418460</code></pre>
<p>HTE test: “The p-value of the ‘differential.forest.prediction’
coefficient also acts as an omnibus test for the presence of
heterogeneity: If the coefficient is significantly greater than 0, then
we can reject the null of no heterogeneity.” (see <a href="https://search.r-project.org/CRAN/refmans/grf/html/test_calibration.html">grf
package documentation</a>)</p>
<pre><code>#&gt; 
#&gt; Best linear fit using forest predictions (on held-out data)
#&gt; as well as the mean forest prediction as regressors, along
#&gt; with one-sided heteroskedasticity-robust (HC3) SEs:
#&gt; 
#&gt;                                Estimate Std. Error t value Pr(&gt;t)
#&gt; mean.forest.prediction           1.2186     1.0253  1.1886 0.1202
#&gt; differential.forest.prediction -15.8933     2.2144 -7.1772 1.0000</code></pre>
<p>Augmented dataset:</p>
<pre><code>#&gt;   indID     race     educ    sex     tau.hat lowerinterval upperinterval
#&gt; 1     1    White       HS   Male -0.08340999    -0.4977373     0.3309173
#&gt; 2     2    Black  College   Male -0.10763178    -0.5219591     0.3066955
#&gt; 3     3    Asian Graduate Female -0.02533602    -0.4396633     0.3889913
#&gt; 4     4 Hispanic  College Female -0.12913305    -0.5434603     0.2851942
#&gt; 5     5    Other       HS   Male -0.10683563    -0.5211629     0.3074916
#&gt;            Y tx (Intercept)   age raceBlack raceHispanic raceOther raceWhite
#&gt; 1  1.3530686  0           1 61.76         0            0         0         1
#&gt; 2  0.3747627  0           1 49.56         1            0         0         0
#&gt; 3 -0.4306161  1           1 35.26         0            0         0         0
#&gt; 4  0.1190191  0           1 30.24         0            1         0         0
#&gt; 5  0.6850489  0           1 25.33         0            0         1         0
#&gt;   educGraduate educHS educLess than HS sexMale      ASIalc
#&gt; 1            0      1                0       1 -0.24608705
#&gt; 2            0      0                0       1 -0.03627714
#&gt; 3            1      0                0       0  0.07794263
#&gt; 4            0      0                0       0 -0.05765359
#&gt; 5            0      1                0       1 -0.28095756</code></pre>
<p>Best linear projection: “Let tau(Xi) = E[Y(1) - Y(0) | X = Xi] be the
CATE, and Ai be a vector of user-provided covariates. This function
provides a (doubly robust) fit to the linear model tau(Xi) ~ beta_0 + Ai
* beta.” (see <a href="https://grf-labs.github.io/grf/reference/best_linear_projection.html">grf
package documentation</a>)</p>
<pre><code>#&gt; 
#&gt; Best linear projection of the conditional average treatment effect.
#&gt; Confidence intervals are cluster- and heteroskedasticity-robust (HC3):
#&gt; 
#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)
#&gt; (Intercept)      -0.497489   0.766840 -0.6488   0.5203
#&gt; age               0.014724   0.014676  1.0032   0.3219
#&gt; raceBlack        -0.068251   1.015000 -0.0672   0.9467
#&gt; raceHispanic      0.741565   0.986563  0.7517   0.4568
#&gt; raceOther        -0.114915   1.075093 -0.1069   0.9154
#&gt; raceWhite         0.079019   0.880045  0.0898   0.9289
#&gt; educGraduate     -0.711684   0.859354 -0.8282   0.4126
#&gt; educHS           -0.969104   0.698573 -1.3873   0.1732
#&gt; educLess.than.HS -0.371093   0.991454 -0.3743   0.7102
#&gt; sexMale           0.383832   0.824177  0.4657   0.6440
#&gt; ASIalc           -1.084591   1.529380 -0.7092   0.4824</code></pre>
<p>Save figures with visualizations (for all studies):</p>
<p>quartz_off_screen 2 [[1]]</p>
<p>[[2]]</p>
<p>quartz_off_screen 2 quartz_off_screen 2</p>
</div>
<div id="option-2-combining-trials" class="section level3">
<h3>Option 2: Combining trials</h3>
<p>Here <a href>cateDisplay()</a> will first combine the data from
all trials, and then estimate the CATE casual forest (including a study
indicator) and assess treatment effect heterogeneity. As noted above,
although technically not required, when merging data coming from
multiple trials, it is highly recommended that the treatment and outcome
have a similar meaning across studies.</p>
<p>[1] “– 95% CI for the ATE: -0.049959 +/- 0.082564” [1] “Estimate:
-0.917 || Pr(&gt;t): 0.927” [1] “The
<code>differential.forest.prediction</code> coefficient is not
significantly greater than 0: we cannot reject the null of no
heterogeneity.”</p>
<p>Again, we can inspect all the elements of the main output, and save
resulting visuals.</p>
<p>ATE:</p>
<pre><code>#&gt;    estimate     std.err 
#&gt; -0.04995945  0.04212521</code></pre>
<p>HTE:</p>
<pre><code>#&gt; 
#&gt; Best linear fit using forest predictions (on held-out data)
#&gt; as well as the mean forest prediction as regressors, along
#&gt; with one-sided heteroskedasticity-robust (HC3) SEs:
#&gt; 
#&gt;                                Estimate Std. Error t value Pr(&gt;t)
#&gt; mean.forest.prediction          0.98896    0.95682  1.0336 0.1508
#&gt; differential.forest.prediction -0.91675    0.63122 -1.4523 0.9267</code></pre>
<p>Augmented dataset:</p>
<pre><code>#&gt;   indID   study  race         educ    sex     tau.hat lowerinterval
#&gt; 1     1 Study 1 Other           HS Female -0.02698241    -0.2152834
#&gt; 2     2 Study 1 White     Graduate   Male  0.04472005    -0.1033834
#&gt; 3     3 Study 1 Other      College   Male -0.05063247    -0.2672534
#&gt; 4     4 Study 1 Other Less than HS Female -0.18339746    -0.3767259
#&gt; 5     5 Study 1 White Less than HS   Male  0.02617363    -0.1661701
#&gt;   upperinterval          Y tx (Intercept) studyStudy2 studyStudy3 studyStudy4
#&gt; 1   0.161318554 -0.4078516  1           1           0           0           0
#&gt; 2   0.192823455  0.8948066  0           1           0           0           0
#&gt; 3   0.165988499  0.4041582  0           1           0           0           0
#&gt; 4   0.009931033  0.5534813  1           1           0           0           0
#&gt; 5   0.218517366  1.2406471  0           1           0           0           0
#&gt;   studyStudy5   age raceBlack raceHispanic raceOther raceWhite educGraduate
#&gt; 1           0 39.79         0            0         1         0            0
#&gt; 2           0 30.91         0            0         0         1            1
#&gt; 3           0 50.05         0            0         1         0            0
#&gt; 4           0 37.88         0            0         1         0            0
#&gt; 5           0 20.00         0            0         0         1            0
#&gt;   educHS educLess than HS sexMale      ASIalc
#&gt; 1      1                0       0 -0.14092776
#&gt; 2      0                0       1 -0.11917133
#&gt; 3      0                0       1 -0.77182919
#&gt; 4      0                1       0  0.39227555
#&gt; 5      0                1       1 -0.02528334</code></pre>
<p>Results from the best linear projection:</p>
<pre><code>#&gt; 
#&gt; Best linear projection of the conditional average treatment effect.
#&gt; Confidence intervals are cluster- and heteroskedasticity-robust (HC3):
#&gt; 
#&gt;                    Estimate Std. Error t value Pr(&gt;|t|)  
#&gt; (Intercept)       0.1233281  0.2228682  0.5534  0.58011  
#&gt; studyStudy2       0.0691042  0.2105410  0.3282  0.74280  
#&gt; studyStudy3       0.0810405  0.1285507  0.6304  0.52854  
#&gt; studyStudy4       0.0781789  0.1359994  0.5748  0.56550  
#&gt; studyStudy5       0.2606031  0.1568427  1.6616  0.09686 .
#&gt; age              -0.0034091  0.0037193 -0.9166  0.35953  
#&gt; raceBlack        -0.1019012  0.1345895 -0.7571  0.44912  
#&gt; raceHispanic     -0.0059514  0.1457941 -0.0408  0.96745  
#&gt; raceOther        -0.1272136  0.1377033 -0.9238  0.35576  
#&gt; raceWhite        -0.1120201  0.1363658 -0.8215  0.41154  
#&gt; educGraduate     -0.0061531  0.1150429 -0.0535  0.95735  
#&gt; educHS           -0.1004966  0.1205597 -0.8336  0.40468  
#&gt; educLess.than.HS -0.2048746  0.1158929 -1.7678  0.07734 .
#&gt; sexMale          -0.0066821  0.0856488 -0.0780  0.93783  
#&gt; ASIalc           -0.1203662  0.1322629 -0.9101  0.36297  
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Save visuals:</p>
<p>quartz_off_screen 2 [[1]]</p>
<p>[[2]]</p>
<p>quartz_off_screen 2 function (res, combine) { if (combine == F) {
blpList &lt;- lapply(res, function(x) { x<span class="math inline">\(BLP  })  model.names &lt;-
unlist(lapply(c(1:length(blpList)), function(i) {  paste0(&quot;Study
&quot;, i)  }))  blps &lt;- jtools::plot_summs(blpList, point.shape =
FALSE,  model.names = model.names)  dfg &lt;- blps\)</span>data dfg<span class="math inline">\(study &lt;- as.factor(dfg\)</span>model) dfg<span class="math inline">\(study &lt;- factor(dfg\)</span>study, levels =
c(model.names)) ggBLP &lt;- ggplot2::ggplot(dfg, ggplot2::aes(x = study,
y = estimate, color = term, group = term), ) + ggplot2::coord_flip() +
ggplot2::geom_hline(yintercept = 0, linetype = “dashed”, color =
“black”, size = 0.65) + ggplot2::geom_pointrange(position =
ggplot2::position_dodge(width = 0.75), ggplot2::aes(ymin = conf.low,
ymax = conf.high), alpha = 0.85) + ggplot2::ggtitle(“CATE best linear
projection by Study and Covariate”) + theme_MH + ggplot2::xlab(““) +
ggplot2::ylab(”“) + ggplot2::facet_wrap(~study, scales =”free”) +
ggplot2::xlab(““) + ggplot2::theme(axis.text.y =
ggplot2::element_blank(), ) } else { blpList &lt;- res<span class="math inline">\(BLP  blps &lt;- jtools::plot_summs(blpList,
point.shape = FALSE)  dfg &lt;- blps\)</span>data dfg<span class="math inline">\(study &lt;- dfg\)</span>model ggBLP &lt;-
ggplot2::ggplot(dfg, ggplot2::aes(x = study, y = estimate, color = term,
group = term), ) + ggplot2::coord_flip() +
ggplot2::geom_hline(yintercept = 0, linetype =”dashed”, color = “black”,
size = 0.65) + ggplot2::geom_pointrange(position =
ggplot2::position_dodge(width = 0.75), ggplot2::aes(ymin = conf.low,
ymax = conf.high), alpha = 0.85) + ggplot2::ggtitle(“CATE best linear
projection by Covariate”) + theme_MH + ggplot2::xlab(““) +
ggplot2::ylab(”“) + ggplot2::theme(axis.text.y =
ggplot2::element_blank(), ) } return(ggBLP) } &lt;bytecode:
0x7ff4466bd070&gt; &lt;environment: namespace:CATEDisplays&gt;
quartz_off_screen 2</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
